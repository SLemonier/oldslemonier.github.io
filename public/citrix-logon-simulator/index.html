<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Steven Lemonier">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://stevenlemonier.fr/img/title_logonsimulator.jpg">
    <meta property="twitter:image" content="https://stevenlemonier.fr/img/title_logonsimulator.jpg" />
    

    
    <meta name="title" content="Citrix Logon Simulator" />
    <meta property="og:title" content="Citrix Logon Simulator" />
    <meta property="twitter:title" content="Citrix Logon Simulator" />
    

    
    <meta name="description" content="A Free and Open Source Logon Simulator for Citrix to test the launch of any published application or desktop, through a Citrix Gateway or Citrix Storefront">
    <meta property="og:description" content="A Free and Open Source Logon Simulator for Citrix to test the launch of any published application or desktop, through a Citrix Gateway or Citrix Storefront" />
    <meta property="twitter:description" content="A Free and Open Source Logon Simulator for Citrix to test the launch of any published application or desktop, through a Citrix Gateway or Citrix Storefront" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Steven, Lemonier, Citrix, PowerShell, automation, CTA">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Citrix Logon Simulator-Sharing knowledge and automation on Citrix topics</title>

    <link rel="canonical" href="/citrix-logon-simulator/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css" rel="stylesheet" type="text/css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    

    
<script data-id="matomo-tracking" data-matomo-tracking-url='https://matomo.stevenlemonier.fr' data-matomo-tracking-id='1' src="/js/matomo-tracking.min.d8e1498fb42aa6048c4db4ac8451d0141fe4a0a83a1b4857df2a67a0cabd350a.js" integrity="sha256-2OFJj7QqpgSMTbSshFHQFB/koKg6G0hX3ypnoMq9NQo=" crossorigin="anonymous" defer></script>
</head>




<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Steven Lemonier</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
		    
                        <li><a href="/top/archive/">ARCHIVE</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/title_logonsimulator.jpg');
        box-shadow: inset 0px 0px 300px 200px rgba(0,0,0,0.6);
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/citrix" title="Citrix">
                            Citrix
                        </a>
                        
                        <a class="tag" href="/tags/logon-simulator" title="Logon Simulator">
                            Logon Simulator
                        </a>
                        
                        <a class="tag" href="/tags/gateway" title="Gateway">
                            Gateway
                        </a>
                        
                        <a class="tag" href="/tags/storefront" title="Storefront">
                            Storefront
                        </a>
                        
                        <a class="tag" href="/tags/automation" title="Automation">
                            Automation
                        </a>
                        
                    </div>
                    <h1>Citrix Logon Simulator</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                 Steven
                             
                            on 
                            Thursday, May 12, 2022
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <p><em><strong>Note:</strong> I recommend you to read the following post but if you&rsquo;re only interested by the script: <a href="https://github.com/SLemonier/Citrix-Logon-Simulator">here it is</a>.</em></p>
<p><em>Edit 6/27/2022: Sometimes, selenium can be a bit annoying. I found version 3.8 of the package resolves the issue. Pyautogui as well has somme issue at the installation on some machines, I use now a method from Pillow to do a screenshot.</em></p>
<h1 id="an-introduction">An introduction</h1>
<p>I always wanted to monitor correctly the end-user experience and especially application availability. Like, at any time of the day, can my business-critical resource be opened without any issue? And if there is, at which stage does it fail? Log on to the portal? Application enumeration? At the application launch?</p>
<p>I know there are some logon simulators available on the market. But they usually come with three majors caveats:</p>
<ul>
<li>you have to pay for it</li>
<li>they are bound to a suite of applications (that you have to pay for&hellip;)</li>
<li>I was not able to have them work (and you know, when it does not work the first time, I usually decide to do it on my own)</li>
</ul>
<p>One day, <a href="https://tyler.io/lets-reimplement-an-amazing-first-party-feature-in-the-dumbest-way-possible/">I read about a guy automating an MFA form by doing OCR on his Mac</a>. Thought it was genius and wondered if Windows could do something like that (I already had the logon simulator in mind but didn&rsquo;t know how to do it). It does, by default! Windows 10/11 can do a screenshot in PowerShell and run some OCR on it.</p>
<p>It was great. Then I tried on a Windows Server (because I use a server for some monitoring scripts). It became a nightmare. OCR is bound to a component only available on desktop OS. I was so pissed about it!</p>
<p>I know, I could have used Windows 10 but I wanted to have it on a Windows Server!</p>
<p>So I let it on a corner of the table for a better day. It came when a former colleague told me:</p>
<blockquote>
<p>Python is way better in automation than PowerShell. Do Python Steven. At least for this project.</p>
</blockquote>
<p>And I tried. And finally got it down in Python. Way more reliable and not OS-dependent.</p>
<p>So here it is!</p>
<p><a href="https://github.com/SLemonier/Citrix-Logon-Simulator">You can find the script here</a>.</p>
<h1 id="pre-requisites">Pre-requisites</h1>
<p>To run the script, you must have the following pre-requisites:</p>
<ul>
<li>Python 3 (<a href="https://www.python.org/downloads/">Official website</a>)</li>
<li>Tesseract, for OCR (<a href="https://github.com/UB-Mannheim/tesseract/wiki">Windows build</a>)</li>
<li>Tesseract installation folder added to Windows PATH environment variable</li>
<li>Firefox (<a href="https://www.mozilla.org/en-US/firefox/new/">Official website</a>)</li>
<li>Geckodriver, aligned with Firefox version you installed (<a href="https://github.com/mozilla/geckodriver/releases">Github repository</a>)</li>
<li>you <strong>MUST</strong> enable HTML5 receiver as the script does not rely on Citrix Workspace App</li>
</ul>
<p>Once all those pre-requisites are installed, you must run the following command in PowerShell to download the modules required to run Citrix Logon Simulator (the machine you running the script on must have internet access):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>pip install selenium<span style="color:#ff79c6">==</span><span style="color:#bd93f9">3.8</span> pypiwin32 requests Pillow pytesseract
</span></span></code></pre></div><p>To write events in Windows Event Log, the Event Source must be created first (value can be modified within the Python script, just edit the variable &lsquo;EventSource&rsquo;). In Powershell, execute the following commands, as an Administrator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$eventsource</span> = <span style="color:#f1fa8c">&#34;Citrix.LogonSimulator&#34;</span> <span style="color:#6272a4">#Align the value with the one you edited in the Python script</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$EventLogSourceParams</span> = @{
</span></span><span style="display:flex;"><span>    LogName = <span style="color:#f1fa8c">&#39;Application&#39;</span>
</span></span><span style="display:flex;"><span>    Source = <span style="color:#8be9fd;font-style:italic">$eventsource</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">New-EventLog</span> <span style="color:#8be9fd;font-style:italic">@EventLogSourceParams</span>
</span></span></code></pre></div><h1 id="edit-the-variables">Edit the variables</h1>
<p>Before running the logon simulator, you must edit some variables to adapt it to your environment:</p>
<ul>
<li>EventSource (The event&rsquo;s source of the events that will be written in Windows Event Log)</li>
<li>username (do I need to explain?)</li>
<li>password (really?)</li>
<li>URL (doesn&rsquo;t matter if it&rsquo;s a Citrix Gateway or a Storefront, https or not, just enter the URL you want to log to)</li>
<li>ResourceToTest (the published resource to launch, it must be added to the favorites for the testing user before running the script)</li>
<li>Screenshotfile (where and how to name the screenshot file to do OCR to, can stay as is)</li>
<li>TextToFind (to validate the application has been properly launched, the script takes a screenshot and runs OCR on it to find this text)</li>
<li>LogFile (path for the log file, so you can share it with me if something does not work as expected)</li>
</ul>
<h1 id="run-the-script">Run the script</h1>
<p>Running the python script (<a href="https://github.com/SLemonier/Citrix-Logon-Simulator">available on github</a>) is pretty straightforward, just run the following command in Powershell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>python CitrixLogonSimulator.py
</span></span></code></pre></div><p>You&rsquo;ll get the following output (at least, if it goes to end!):</p>
<p>
  <figure>
    <img src="Script_output.png" alt="Script output">
    <center><figcaption>Script output... when the resource launched properly!</figcaption></center>
  </figure>

</p>
<p>What the script does.</p>
<p>It tries to resolve the URL, no need to go deeper if it&rsquo;s not accessible right!</p>
<p>Then, it launches an instance of Firefox and goes to the URL. It will check if it&rsquo;s a Citrix Gateway or a Storefront and will adapt the logon process according to its findings.</p>
<p>It logs on, looks for the resource to test once application enumeration is finished, and launches it.</p>
<p>It waits for 60 seconds and takes a screenshot.</p>
<p>And finally runs OCR to check if it launched the resources properly.</p>
<p>At each stage, it will generate some events (and logs in the logfile, of course):</p>
<ul>
<li>Event ID 12001, information, in case of success, with some details</li>
<li>Event ID 12002, error, in case of a failure, with some details</li>
</ul>
<p>
  <figure>
    <img src="Logon-Failure.png" alt="Logon failure generates an error event.">
    <center><figcaption>Logon failure generates an error event.</figcaption></center>
  </figure>

</p>
<p>And if it worked properly, it will generate an Event ID 12000!</p>
<p>Thus, if you understood correctly, monitor the machine the script is running on for Event ID 12002 (as an alert trigger) to be proactive with your applications/desktops availability!</p>
<p>Here is a quick demo:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/p16roep2Cps" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="limitations">Limitations</h1>
<p>As the logon simulator is more an MVP (standing for Minimum Viable Product), it comes with some limitations I hope I&rsquo;ll address in a near future.</p>
<p>Here they are (don&rsquo;t worry, they&rsquo;re not that much big of a deal):</p>
<ul>
<li>to install python modules (using &lsquo;pip install&rsquo; command), the computer/virtual machine must have access to the internet; for offline modules installation, it&rsquo;s trickier, I&rsquo;m looking for a reliable way to redistribute those</li>
<li>using a proxy must be tested, it may depend on the type of proxy you are using; if you have an issue with the proxy, just let me know on <a href="https://twitter.com/StevenLemonier">Twitter</a> or <a href="https://github.com/SLemonier/Citrix-Logon-Simulator">open an issue on the Github repo</a>, I&rsquo;ll be glad to help</li>
<li>supported logon process is limited to login/password</li>
<li>password is not encrypted, use a test account with very limited rights!</li>
<li>the resource to test (application or desktop) must be added to the favorites for the testing user before running the script as told earlier</li>
<li>it&rsquo;s not yet able to manage the logon duration, thus, it waits for 60 seconds and takes a screenshot; if your logon duration is longer (Booooh 🤭), increase the value of <em>&lsquo;Sleep(60)&rsquo;</em></li>
<li>the script does basic OCR (I can add more processing on the image to improve the OCR), it&rsquo;s better to look for some text with high contrast (like black strings on white background) and to not have too much text displayed on the page</li>
<li>events generated in Windows Event Log are pretty basic, and messages can be improved (I&rsquo;m open to suggestions!)</li>
<li>and as I write Windows Event Log, the script is running only on Windows, even if python runs on every OS; if you&rsquo;d need the script for Linux, I can do a specific version 😉</li>
</ul>
<p>One last limitation, if you&rsquo;re running the script for monitoring purposes, you have to use auto logon on your machine and run the script as a logon script. It does some interactive stuff (like launching Firefox and doing a screenshot) and it cannot run as an unattended script. Sorry 😟</p>
<h1 id="upcoming-improvements">Upcoming improvements</h1>
<p>Here are some improvements I have in mind but feel free to share your suggestions, I&rsquo;ll be more than happy to add them:</p>
<ul>
<li>Improve OCR processing</li>
<li>Improve messages in Windows Event Log</li>
<li>Do a screenshot at every stage and store them for history</li>
<li>Look for the ResourceToTest in other tabs than the landing one once application enumeration is finished (like looking in apps or desktops tabs if the resource is not added to the favorites)</li>
<li>Support MFA, but this will require your help, so, please contact me if you need such a feature!</li>
<li>Encrypt password (I have a workaround with OS variables to now have it stored in plain text in the script but this solution is not perfect)</li>
</ul>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/fslogix-profile-container-applications-crashing/" data-toggle="tooltip" data-placement="top" title="FSLogix profile container - Applications are crashing">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/citrix-chaos-monkey-part-one/" data-toggle="tooltip" data-placement="top" title="Citrix Chaos Monkey - Part One">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">Table of content</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/citrix" title="citrix">
                            citrix
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/gateway" title="gateway">
                            gateway
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/powershell" title="powershell">
                            powershell
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://davidsalvatore.tech/">David Salvatore</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="Steven Lemonier" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:mail@stevenlemonier.fr">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    <li>
                        <a href="https://twitter.com/StevenLemonier/">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/SLemonier">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/stevenlemonier/">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Steven Lemonier 2022
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>









<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>


</body>
</html>
